
{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "type": "object",
      "description": "Represents a registered user's public profile.",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID from Firebase Auth." },
        "displayName": { "type": "string", "description": "The user's public display name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "photoURL": { "type": "string", "format": "uri", "description": "URL of the user's profile picture." },
        "lastLogin": { "type": "string", "format": "date-time", "description": "Timestamp of the user's last login." }
      },
      "required": ["uid", "displayName", "email", "photoURL"]
    },
    "Chat": {
      "title": "Chat Room",
      "type": "object",
      "description": "Represents a conversation between two or more users.",
      "properties": {
        "participants": { 
          "type": "array", 
          "items": { "type": "string" },
          "description": "An array of user UIDs who are part of the chat."
        },
        "createdAt": { "type": "string", "format": "date-time" },
        "lastMessage": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "senderId": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" }
          }
        },
        "typing": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Array of user UIDs who are currently typing."
        },
        "userStatus": {
            "type": "object",
            "description": "Maps user UIDs to their status in the chat (e.g., unread count)."
        }
      },
      "required": ["participants", "createdAt"]
    },
    "ChatMessage": {
      "title": "Chat Message",
      "type": "object",
      "description": "A single message within a chat.",
      "properties": {
        "senderId": { "type": "string", "description": "The UID of the user who sent the message." },
        "text": { "type": "string", "description": "The content of the message." },
        "timestamp": { "type": "string", "format": "date-time", "description": "The time the message was sent." }
      },
      "required": ["senderId", "text", "timestamp"]
    }
  },
  "auth": {
    "providers": ["google.com", "github.com", "facebook.com"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "schema": { "$ref": "#/entities/UserProfile" },
        "description": "Stores public user profile information."
      },
      {
        "path": "/chats/{chatId}",
        "schema": { "$ref": "#/entities/Chat" },
        "description": "Metadata for a chat session, including participants."
      },
      {
        "path": "/chats/{chatId}/messages/{messageId}",
        "schema": { "$ref": "#/entities/ChatMessage" },
        "description": "Sub-collection storing all messages for a given chat."
      }
    ],
    "reasoning": "This structure supports an authenticated chat system. The 'users' collection acts as a directory. The 'chats' collection manages conversations, using an array of participant UIDs for access control. This avoids complex queries and allows security rules to efficiently verify user permissions by simply checking if a user's UID is in the 'participants' array of a chat document."
  }
}
