{
  "entities": {
    "Session": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Session",
      "type": "object",
      "description": "Represents a user's session, used for identifying users without requiring login details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the session."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the session was created.",
          "format": "date-time"
        },
        "expiryTime": {
          "type": "string",
          "description": "Timestamp indicating when the session should expire.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "createdAt",
        "expiryTime"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single chat message between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderSessionId": {
          "type": "string",
          "description": "Reference to Session of the message sender. (Relationship: Session 1:N ChatMessage)"
        },
        "receiverSessionId": {
          "type": "string",
          "description": "Reference to Session of the message receiver. (Relationship: Session 1:N ChatMessage)"
        },
        "content": {
          "type": "string",
          "description": "The encrypted content of the chat message."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the message (e.g., sent, delivered, opened).",
          "format": "string"
        }
      },
      "required": [
        "id",
        "senderSessionId",
        "receiverSessionId",
        "content",
        "timestamp",
        "status"
      ]
    },
    "InviteLink": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InviteLink",
      "type": "object",
      "description": "Represents a one-time use invite link for creating a new chat session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the invite link."
        },
        "creatorSessionId": {
          "type": "string",
          "description": "Reference to Session of the user who created the invite link. (Relationship: Session 1:N InviteLink)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the invite link was created.",
          "format": "date-time"
        },
        "expiryTime": {
          "type": "string",
          "description": "Timestamp indicating when the invite link should expire.",
          "format": "date-time"
        },
        "used": {
          "type": "boolean",
          "description": "Indicates whether the invite link has been used or not."
        }
      },
      "required": [
        "id",
        "creatorSessionId",
        "createdAt",
        "expiryTime",
        "used"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/sessions/{sessionId}",
        "definition": {
          "entityName": "Session",
          "schema": {
            "$ref": "#/backend/entities/Session"
          },
          "description": "Stores session information, including creation and expiry timestamps.",
          "params": [
            {
              "name": "sessionId",
              "description": "Unique identifier for the session."
            }
          ]
        }
      },
      {
        "path": "/sessions/{sessionId}/chatMessages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages associated with a specific session. Includes sender and receiver session IDs for authorization purposes.",
          "params": [
            {
              "name": "sessionId",
              "description": "Session ID associated with either the sender or receiver."
            },
            {
              "name": "chatMessageId",
              "description": "Unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/inviteLinks/{inviteLinkId}",
        "definition": {
          "entityName": "InviteLink",
          "schema": {
            "$ref": "#/backend/entities/InviteLink"
          },
          "description": "Stores invite link information, including the creator's session ID, creation and expiry timestamps, and usage status.",
          "params": [
            {
              "name": "inviteLinkId",
              "description": "Unique identifier for the invite link."
            }
          ]
        }
      }
    ],
    "reasoning": "Given the application's emphasis on anonymity, ephemeral messages, and the absence of traditional user accounts, the Firestore structure is designed around temporary sessions.  Since there are no user accounts and we need to avoid using custom claims, we will follow a path-based approach using sessionId's to identify message ownership and access. This structure facilitates secure `list` operations because access to a message is predicated on knowing either the sender or receiver session ID, preventing unauthorized listing of messages. Authorization Independence is achieved since access control relies solely on session IDs present in the document itself, thus no `get()` calls are needed in the rules."
  }
}